<?xml version="1.0" encoding="UTF-8" ?>

<schema name="UBO Schema" version="1.5">

  <!-- SOLR internal fields -->
  <field name="_version_" type="long"   indexed="true" stored="true"  />
  <field name="_root_"    type="string" indexed="true" stored="false" />

  <!-- MyCoRe general fields -->
  <field name="id"            type="string" indexed="true" stored="true"  required="true"  multiValued="false" />
  <field name="returnId"      type="string" indexed="true" stored="true"  required="false" multiValued="false" />
  <field name="objectType"    type="string" indexed="true" stored="false" required="false" multiValued="false" />
  <field name="objectProject" type="string" indexed="true" stored="false" required="false" multiValued="false" />
  <field name="created"       type="date"   indexed="true" stored="false" required="false" multiValued="false" />
  <field name="modified"      type="date"   indexed="true" stored="true"  required="true"  multiValued="false" />

  <!-- UniversitÃ¤tsbibliographie fields -->
  <field name="title"      type="text"      indexed="true" stored="true"  multiValued="true"  />
  <field name="person"     type="name"      indexed="true" stored="true"  multiValued="true"  />
  <field name="genre"      type="string"    indexed="true" stored="true"  multiValued="false" />
  <field name="subject"    type="string"    indexed="true" stored="true"  multiValued="true"  />
  <field name="origin"     type="string"    indexed="true" stored="false" multiValued="true"  />
  <field name="status"     type="string"    indexed="true" stored="false" multiValued="false" />
  <field name="host_title" type="text"      indexed="true" stored="false" multiValued="true"  />
  <field name="host_genre" type="string"    indexed="true" stored="true"  multiValued="false" />
  <field name="journal"    type="journal"   indexed="true" stored="false" multiValued="true"  />
  <field name="series"     type="text"      indexed="true" stored="false" multiValued="true"  />
  <field name="conference" type="text"      indexed="true" stored="false" multiValued="false" />
  <field name="note"       type="text"      indexed="true" stored="false" multiValued="true"  />
  <field name="abstract"   type="text"      indexed="true" stored="false" multiValued="true"  />
  <field name="year"       type="int"       indexed="true" stored="true"  multiValued="false" />
  <field name="year_diss"  type="int"       indexed="true" stored="false" multiValued="false" />
  <field name="lang"       type="string"    indexed="true" stored="false" multiValued="true"  />
  <field name="shelfmark"  type="shelfmark" indexed="true" stored="false" multiValued="true"  />
  <field name="tag"        type="string"    indexed="true" stored="false" multiValued="true"  />
  <field name="dedup"      type="string"    indexed="true" stored="false" multiValued="true"  />

  <!-- Extra fields for sorting -->
  <field name="sortby_title"  type="sort" indexed="true" stored="false" multiValued="false" />
  <field name="sortby_person" type="sort" indexed="true" stored="false" multiValued="false" />

  <!-- Extra facet fields to display -->
  <field name="facet_person" type="string" indexed="true" stored="false" multiValued="true"  />
  <copyField source="person_*" dest="facet_person"/>

  <field name="facet_host" type="string" indexed="true" stored="false" multiValued="true"  />
  <copyField source="host_title" dest="facet_host"/>

  <!-- Fields for each person role, e.g. <mods:roleTerm>aut ==> person_aut -->
  <dynamicField name="person_*"  type="name" indexed="true" stored="false" multiValued="true" />
  <copyField source="person_*" dest="person"/>
  
  <!-- Fields for each LSF person ID and role, e.g. role_lsf=aut_1234 -->
  <field name="role_lsf" type="string" indexed="true" stored="false" multiValued="true" />

  <!-- Fields for mods:identifier, e.g. <mods:identifier type="doi" /> ==> id_doi -->
  <dynamicField name="id_*"  type="id" indexed="true" stored="false" multiValued="true" />
  
  <!-- Fields for mods:nameIdentifier, e.g. <mods:nameIdentifier type="scopus" /> ==> nid_scopus -->
  <dynamicField name="nid_*" type="id" indexed="true" stored="false" multiValued="true" />

  <!-- Field to search in "all fields" (not really all, but most) -->
  <field name="all" type="text" indexed="true" stored="false" multiValued="true" />
  <copyField source="person_*"   dest="all" />
  <copyField source="title"      dest="all" />
  <copyField source="host_title" dest="all" />
  <copyField source="series"     dest="all" />
  <copyField source="conference" dest="all" />
  <copyField source="note"       dest="all" />
  <copyField source="abstract"   dest="all" />
  <copyField source="year"       dest="all" />
  <copyField source="tag"        dest="all" />
  <copyField source="id_*"       dest="all" />

  <!-- Ignore all other fields -->
  <dynamicField name="*" type="ignored" />

  <uniqueKey>id</uniqueKey>

  <fieldType name="string"  class="solr.StrField"      sortMissingLast="true" />
  <fieldType name="int"     class="solr.TrieIntField"  precisionStep="0" positionIncrementGap="0"/>
  <fieldType name="long"    class="solr.TrieLongField" precisionStep="0" positionIncrementGap="0" />
  <fieldType name="date"    class="solr.TrieDateField" precisionStep="0" positionIncrementGap="0"/>
  <fieldtype name="ignored" class="solr.StrField"      stored="false" indexed="false" multiValued="true"  />

  <!-- Field type for text such as title, abstract, comment -->
  <fieldType name="text" class="solr.TextField" positionIncrementGap="100">
    <analyzer type="index">
      <charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
      <tokenizer class="solr.StandardTokenizerFactory" />
      <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
      <filter class="solr.GermanNormalizationFilterFactory"/>
      <filter class="solr.ICUNormalizer2FilterFactory" name="nfkc_cf" mode="compose"/>
    </analyzer>
    <analyzer type="query">
      <charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
      <tokenizer class="solr.StandardTokenizerFactory" />
      <filter class="solr.SynonymFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true" />
      <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
      <filter class="solr.GermanNormalizationFilterFactory"/>
      <filter class="solr.ICUNormalizer2FilterFactory" name="nfkc_cf" mode="compose"/>
    </analyzer>
  </fieldType>

  <!-- Field type for names such as author, editor, place -->
  <fieldType name="name" class="solr.TextField" positionIncrementGap="100">
    <analyzer type="index">
      <charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
      <!-- Turnbull, Douglas G. ==> Turnbull, Douglas D G. to force all initials found -->
      <charFilter class="solr.PatternReplaceCharFilterFactory" pattern="\s+(\S)(\S+)" replacement=" $1$2 $1" />
      <tokenizer class="solr.StandardTokenizerFactory" />
      <filter class="solr.GermanNormalizationFilterFactory"/>
      <filter class="solr.ICUNormalizer2FilterFactory" name="nfkc_cf" mode="compose"/>
    </analyzer>
    <analyzer type="query">
      <charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
      <tokenizer class="solr.StandardTokenizerFactory" />
      <filter class="solr.GermanNormalizationFilterFactory"/>
      <filter class="solr.ICUNormalizer2FilterFactory" name="nfkc_cf" mode="compose"/>
    </analyzer>
  </fieldType>
  
  <!-- Field type for journal title to support for abbreviated titles, "Advances in Physics" vs. "Adv Phys" -->
  <fieldType name="journal" class="solr.TextField" positionIncrementGap="100">
    <analyzer type="index">
      <charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
      <tokenizer class="solr.StandardTokenizerFactory" />
      <filter class="solr.GermanNormalizationFilterFactory"/>
      <filter class="solr.ICUNormalizer2FilterFactory" name="nfkc_cf" mode="compose"/>
      <filter class="solr.EdgeNGramFilterFactory" minGramSize="1" maxGramSize="15" />
    </analyzer>
    <analyzer type="query">
      <charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
      <tokenizer class="solr.StandardTokenizerFactory" />
      <filter class="solr.GermanNormalizationFilterFactory"/>
      <filter class="solr.ICUNormalizer2FilterFactory" name="nfkc_cf" mode="compose"/>
      <filter class="solr.EdgeNGramFilterFactory" minGramSize="1" maxGramSize="15" />
    </analyzer>
  </fieldType>

  <!-- Field type for sorting by title, person names -->
  <fieldType name="sort" class="solr.TextField" sortMissingLast="true">
    <analyzer type="index">
      <charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
      <tokenizer class="solr.KeywordTokenizerFactory"/>
      <filter class="solr.GermanNormalizationFilterFactory"/>
      <filter class="solr.ICUNormalizer2FilterFactory" name="nfkc_cf" mode="compose"/>
      <filter class="solr.PatternReplaceFilterFactory" pattern="([^A-Za-z0-9])" replacement="" replace="all"/>
    </analyzer>
    <analyzer type="query">
      <charFilter class="solr.MappingCharFilterFactory" mapping="mapping-ISOLatin1Accent.txt"/>
      <tokenizer class="solr.KeywordTokenizerFactory"/>
      <filter class="solr.GermanNormalizationFilterFactory"/>
      <filter class="solr.ICUNormalizer2FilterFactory" name="nfkc_cf" mode="compose"/>
      <filter class="solr.PatternReplaceFilterFactory" pattern="([^A-Za-z0-9])" replacement="" replace="all"/>
    </analyzer>
  </fieldType>

  <!-- Field type for identifiers such as ISBN, ISSN: remove hyphens -->
  <fieldType name="id" class="solr.TextField">
    <analyzer type="index">
      <tokenizer class="solr.WhitespaceTokenizerFactory" />
      <filter class="solr.PatternReplaceFilterFactory" pattern="-" replacement="" replace="all" />
      <filter class="solr.LowerCaseFilterFactory" />
    </analyzer>
    <analyzer type="query">
      <tokenizer class="solr.WhitespaceTokenizerFactory" />
      <filter class="solr.PatternReplaceFilterFactory" pattern="-" replacement="" replace="all" />
      <filter class="solr.LowerCaseFilterFactory" />
    </analyzer>
  </fieldType>

  <!-- Field type for shelfmarks: lowercase, remove whitespace, remove +NNN -->
  <fieldType name="shelfmark" class="solr.TextField">
    <analyzer type="index">
      <tokenizer class="solr.KeywordTokenizerFactory"/>
      <filter class="solr.LowerCaseFilterFactory" />
      <filter class="solr.PatternReplaceFilterFactory" pattern="\s" replacement="" replace="all" />
      <filter class="solr.PatternReplaceFilterFactory" pattern="\+[0-9]+" replacement="" replace="all" />
    </analyzer>
    <analyzer type="query">
      <tokenizer class="solr.KeywordTokenizerFactory"/>
      <filter class="solr.LowerCaseFilterFactory" />
      <filter class="solr.PatternReplaceFilterFactory" pattern="\s" replacement="" replace="all" />
      <filter class="solr.PatternReplaceFilterFactory" pattern="\+[0-9]+" replacement="" replace="all" />
    </analyzer>
  </fieldType>

</schema>
