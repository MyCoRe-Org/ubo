<?xml version="1.0" encoding="UTF-8"?>

<searchfields xmlns="http://www.mycore.org/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mycore.org/ searchfields.xsd" 
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:mcr="http://www.mycore.org/"
  xmlns:mods="http://www.loc.gov/mods/v3"
>

  <index id="metadata">
    <field source="objectMetadata" name="id"           type="identifier" xpath="/mycoreobject" value="@ID" />
    <field source="objectMetadata" name="status"       type="identifier" xpath="/mycoreobject/service/servflags/servflag[@type='status']" value="text()" />
    <field source="objectMetadata" name="tag"          type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:extension/tag" value="text()" />
    <field source="objectMetadata" name="dedup"        type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:extension/dedup" value="@key" />
    <field source="objectMetadata" name="lastModified" type="timestamp"  xpath="/mycoreobject/service/servdates/servdate[@type='modifydate']" value="substring-before(translate(text(),'TZ',' '),'.')" sortable="true" />
    <field source="objectMetadata" name="datemodified" type="date"       xpath="/mycoreobject/service/servdates/servdate[@type='modifydate']" value="substring-before(text(),'T')" sortable="true" />
    <field source="objectMetadata" name="type"         type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:genre[@type='intern']" sortable="true" />
    <field source="objectMetadata" name="pid"          type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name/mods:nameIdentifier[@type='lsf']" value="text()" />
    <field source="objectMetadata" name="orcid"        type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name/mods:nameIdentifier[@type='orcid']" value="text()" />
    <field source="objectMetadata" name="researcherid" type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name/mods:nameIdentifier[@type='researcherid']" value="text()" />
    <field source="objectMetadata" name="gnd"          type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name/mods:nameIdentifier[@type='gnd']" value="text()" />
    <field source="objectMetadata" name="year"         type="integer"    xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:dateIssued[1]" value="text()" sortable="true" />
    <field source="objectMetadata" name="journal"      type="text"       xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:relatedItem[@type='host'][mods:genre='journal']/mods:titleInfo" value="concat(mods:title,' ',mods:subTitle)" />
    <field source="objectMetadata" name="series"       type="text"       xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:relatedItem[@type='series']/mods:titleInfo" value="concat(mods:title,' ',mods:subTitle)" />
    <field source="objectMetadata" name="conference"   type="text"       xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/descendant::mods:name[@type='conference']" value="mods:namePart" />
    <field source="objectMetadata" name="comment"      type="text"       xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:note" value="text()" />
    <field source="objectMetadata" name="abstract"     type="text"       xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:abstract" value="text()" />
    <field source="objectMetadata" name="isbn"         type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:identifier[@type='isbn']" value="text()" />
    <field source="objectMetadata" name="issn"         type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:identifier[@type='issn']" value="text()" />
    <field source="objectMetadata" name="signature"    type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:shelfLocator" value="text()" />
    <field source="objectMetadata" name="doi"          type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:identifier[@type='doi']" value="text()" />
    <field source="objectMetadata" name="urn"          type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:identifier[@type='urn']" value="text()" />
    <field source="objectMetadata" name="pubmed"       type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:identifier[@type='pubmed']" value="text()" />
    <field source="objectMetadata" name="scopus"       type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:identifier[@type='scopus']" value="text()" />
    <field source="objectMetadata" name="documentID"   type="identifier" xpath="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:identifier[@type='duepublico']" value="text()" />
    
    <field source="objectMetadata" name="all" type="text">
      <mcr:all>
        <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods">
          <xsl:for-each select="descendant::mods:*">
            <xsl:value-of select="text()" />
            <xsl:text> </xsl:text>
          </xsl:for-each>
        </xsl:for-each>
      </mcr:all>
    </field>

    <field source="objectMetadata" name="role_pid" type="identifier">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name[mods:nameIdentifier[@type='lsf']]/mods:role/mods:roleTerm">
        <mcr:role_pid>
          <xsl:value-of select="concat(.,'_',../../mods:nameIdentifier[@type='lsf'])" />
        </mcr:role_pid>
        <mcr:role_pid>
          <xsl:choose>
            <xsl:when test=".='aut'">author</xsl:when>
            <xsl:when test=".='edt'">publisher</xsl:when>
            <xsl:when test=".='ths'">advisor</xsl:when>
            <xsl:when test=".='rev'">referee</xsl:when>
            <xsl:when test=".='trl'">translator</xsl:when>
            <xsl:when test=".='ctb'">contributor</xsl:when>
            <xsl:otherwise>contributor</xsl:otherwise>
          </xsl:choose>
          <xsl:value-of select="concat('_',../../mods:nameIdentifier[@type='lsf'])" />
        </mcr:role_pid>
      </xsl:for-each>
    </field>

    <field source="objectMetadata" name="diss_year" type="integer">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:note">
        <xsl:if test="contains(.,'Univ') and contains(.,'Diss') and ( contains(.,'Essen') or contains(.,'Duisburg') ) and contains( translate(.,'0123456789','JJJJJJJJJJ'),'JJJJ')">
          <xsl:variable name="jjjj" select="translate(.,'0123456789','JJJJJJJJJJ')" />
          <xsl:variable name="before" select="substring-before($jjjj,'JJJJ')" />
          <mcr:diss_year>
            <xsl:value-of select="substring(substring-after(.,$before),1,4)" />
          </mcr:diss_year>
        </xsl:if>
      </xsl:for-each>
    </field>

    <field source="objectMetadata" name="title" type="text">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:titleInfo">
        <mcr:title>
          <xsl:value-of select="concat(mods:nonSort,' ',mods:title,' ',mods:subTitle)" />
        </mcr:title>
      </xsl:for-each>
    </field>
    
    <field source="objectMetadata" name="sortby_title" type="text" sortable="true">
      <mcr:sortby_title>
        <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods//mods:titleInfo">
          <xsl:value-of select="concat(mods:title,' ',mods:subTitle)" />
          <xsl:text>          </xsl:text>
        </xsl:for-each>
      </mcr:sortby_title>
    </field>

    <field source="objectMetadata" name="sortby_name" type="name" sortable="true">
      <mcr:sortby_name>
        <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name">
          <xsl:value-of select="concat(mods:namePart[@type='family'],' ',mods:namePart[@type='given'],' ')" />
        </xsl:for-each>
      </mcr:sortby_name>
    </field>

    <field source="objectMetadata" name="contributor" type="name">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name">
        <mcr:contributor>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',mods:namePart[@type='given'])" />
        </mcr:contributor>
        <mcr:contributor>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',substring(mods:namePart[@type='given'],1,1),'.')" />
        </mcr:contributor>
        <mcr:contributor>
          <xsl:value-of select="concat(substring(mods:namePart[@type='given'],1,1), '. ',mods:namePart[@type='family'])" />
        </mcr:contributor>
        <mcr:contributor>
          <xsl:value-of select="concat(mods:namePart[@type='given'],' ',mods:namePart[@type='family'])" />
        </mcr:contributor>
      </xsl:for-each>
    </field>

    <field source="objectMetadata" name="author" type="name">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name[mods:role/mods:roleTerm='aut']">
        <mcr:author>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',mods:namePart[@type='given'])" />
        </mcr:author>
        <mcr:author>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',substring(mods:namePart[@type='given'],1,1),'.')" />
        </mcr:author>
        <mcr:author>
          <xsl:value-of select="concat(substring(mods:namePart[@type='given'],1,1), '. ',mods:namePart[@type='family'])" />
        </mcr:author>
        <mcr:author>
          <xsl:value-of select="concat(mods:namePart[@type='given'],' ',mods:namePart[@type='family'])" />
        </mcr:author>
      </xsl:for-each>
    </field>

    <field source="objectMetadata" name="advisor" type="name">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name[mods:role/mods:roleTerm='ths']">
        <mcr:advisor>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',mods:namePart[@type='given'])" />
        </mcr:advisor>
        <mcr:advisor>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',substring(mods:namePart[@type='given'],1,1),'.')" />
        </mcr:advisor>
        <mcr:advisor>
          <xsl:value-of select="concat(substring(mods:namePart[@type='given'],1,1), '. ',mods:namePart[@type='family'])" />
        </mcr:advisor>
        <mcr:advisor>
          <xsl:value-of select="concat(mods:namePart[@type='given'],' ',mods:namePart[@type='family'])" />
        </mcr:advisor>
      </xsl:for-each>
    </field>

    <field source="objectMetadata" name="referee" type="name">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name[mods:role/mods:roleTerm='rev']">
        <mcr:referee>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',mods:namePart[@type='given'])" />
        </mcr:referee>
        <mcr:referee>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',substring(mods:namePart[@type='given'],1,1),'.')" />
        </mcr:referee>
        <mcr:referee>
          <xsl:value-of select="concat(substring(mods:namePart[@type='given'],1,1), '. ',mods:namePart[@type='family'])" />
        </mcr:referee>
        <mcr:referee>
          <xsl:value-of select="concat(mods:namePart[@type='given'],' ',mods:namePart[@type='family'])" />
        </mcr:referee>
      </xsl:for-each>
    </field>

    <field source="objectMetadata" name="publisher" type="name">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:name[mods:role/mods:roleTerm='edt']">
        <mcr:publisher>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',mods:namePart[@type='given'])" />
        </mcr:publisher>
        <mcr:publisher>
          <xsl:value-of select="concat(mods:namePart[@type='family'],', ',substring(mods:namePart[@type='given'],1,1),'.')" />
        </mcr:publisher>
        <mcr:publisher>
          <xsl:value-of select="concat(substring(mods:namePart[@type='given'],1,1), '. ',mods:namePart[@type='family'])" />
        </mcr:publisher>
        <mcr:publisher>
          <xsl:value-of select="concat(mods:namePart[@type='given'],' ',mods:namePart[@type='family'])" />
        </mcr:publisher>
      </xsl:for-each>
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:originInfo/mods:publisher">
        <mcr:publisher>
          <xsl:value-of select="text()" />
        </mcr:publisher>
      </xsl:for-each>
    </field>

    <field source="objectMetadata" name="origin" type="identifier">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:classification[contains(@authorityURI,'ORIGIN')]">
        <xsl:variable name="category" select="substring-after(@valueURI,'#')" /> 
        <xsl:for-each select="document(concat('classification:editor:0:parents:ORIGIN:',$category))/descendant::item">
          <mcr:origin>
            <xsl:value-of select="@value" />
          </mcr:origin>
        </xsl:for-each>
      </xsl:for-each>
    </field>
    
    <field source="objectMetadata" name="subject" type="identifier">
      <xsl:for-each select="/mycoreobject/metadata/def.modsContainer/modsContainer/mods:mods/mods:classification[contains(@authorityURI,'fachreferate')]">
        <mcr:subject>
          <xsl:value-of select="substring-after(@valueURI,'#')" />
        </mcr:subject>
      </xsl:for-each>
    </field>

    <field name="score" source="searcherHitMetadata" type="decimal" sortable="true" />

  </index>
  
</searchfields>
